---
title: "中国社会状况综合调查2021年部分变量频数描述"
author: "李丁"
date: "2026-01-30"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## 前言

　"中国社会状况综合调查"（Chinese Social Survey，简称CSS）是中国社会科学院社会学研究所于2005年发起的一项全国范围内的大型连续性抽样调查项目，目的是通过对全国公众的劳动就业、家庭及社会生活、社会态度等方面的长期纵贯调查，来获取转型时期中国社会变迁的数据资料，从而为社会科学研究和政府决策提供翔实而科学的基础信息。关于CSS2021请参看官网的有关信息 <http://css.cssn.cn/css_sy/>。该调查由中国社会科学院社会学研究所执行，项目主持人为陈光金、李炜。
　

　本命令旨在利用R快速处理Stata格式原数据，并得到基本的统计表格，方便大家对中国的基本情况有初步了解，CSS2021年调查共采集了10136个记录。下面的分析没有进行加权。作者感谢上述机构及其人员提供数据协助，本报告内容由作者自行负责。

　
　在命令中我借助ChatGPT创建了四个简单的频次分析命令，方便我们快速进行单选题、多选题频次分析和双变量交叉分析，输出的表格如Stata输出一样简洁高效。  


### 读入数据
```{r read data,echo=FALSE}
library(haven)
library(tidyverse)
library(ldtool)
library(sjlabelled)
library(magrittr)
library(janitor)
library(gt)
library(ldtool)
library(labelled)
```
### 查看读入的结果
```{r}
setwd("/Users/liding/DATA/CSS/CSS2006-2023/CSS2021")
# 读入数据进行初步处理
css21 <- read_dta("CSS2021.dta")

# 交互分析的时候可以查看变量名及特征
# des(css21)
```

```{r}
css21 %>% tabyl(v4)
css21 %>% count(v4)
```


### 清理CSS2021数据
由于变量标签和取值标签存在一些乱码，提前进行了一些处理。

```{r clean}
#保留标签
# Stata格式的数据存在一些标签问题
#因为标签太长被删截出现了乱码
# 查看哪些变量的标签有问题
bad_labels <- sapply(var_label(css21), function(x) {
  tryCatch({
    nchar(x)
    FALSE
  }, error = function(e) TRUE)
})

names(bad_labels[bad_labels])

has_bad_value_labels <- function(x) {
  labs <- attr(x, "labels")
  if (is.null(labs)) return(FALSE)

  tryCatch({
    nchar(names(labs))
    FALSE
  }, error = function(e) TRUE)
}

bad_vars <- names(css21)[sapply(css21, has_bad_value_labels)]
bad_vars

# 定义两个函数
# 删除变量标签中的乱码部分
clean_variable_labels <- function(df) {
  labs <- var_label(df)

  labs_clean <- lapply(labs, function(x) {
    if (is.null(x) || is.na(x)) return(x)
    iconv(x, from = "", to = "UTF-8", sub = "") |> trimws()
  })

  var_label(df) <- labs_clean
  df
}

# 删除取值标签中乱码部分
clean_value_labels <- function(df) {
  df[] <- lapply(df, function(x) {
    labs <- attr(x, "labels")
    if (is.null(labs)) return(x)

    names(labs) <- iconv(
      names(labs),
      from = "",
      to = "UTF-8",
      sub = ""
    ) |> trimws()

    attr(x, "labels") <- labs
    x
  })
  df
}

#删除数据中的各种自定义缺失值标签
css21 <- css21  %>% 
  clean_variable_labels() %>% 
  clean_value_labels()

labelcss <- get_label(css21)

css21 <- css21 %>% 
#  mutate_all(~ replace(., .==-1|.==-2|.==-8|.==98|.==99|.==9999997|.==9999998|.==9999999, NA)) %>% 
  #删除没有使用的取值标签（包括特殊定义值的标签）
  drop_labels()  %>%  
  #将仍然带有标签的变量转换为因子变量
  sjlabelled::as_label(drop.levels = TRUE) %>% 
  #将无取值标签变量转换为数字变量，取消is.labelled 属性
  mutate_if(is.labelled, ~ as_numeric(as.character(.))) %>%
  set_label(labelcss)  # 重新贴标签

```


```{r}
# 做了基本的标签处理后，数据的可理解性可以提高。
css21%>% tabyl(v4)
css21%>% count(v4)
```

### 定义一个单变量频数分析函数
```{r tab1}
# tab1函数
tab1(css21, v4)
```

### 批量做单变量频次分析的函数

```{r}
tab_1(css21, h1a_1:h1a_8,h1a_9)
tab_1(css21, h2a_1:h2a_12)
```

### 多选题频次分析函数
```{r}

mrtab(css21, h1a_1:h1a_8,h1a_9,
      select_value="是",title_prefix="加入了何种社群或组织")
```

### 列联表分析

```{r}
# 列联表 行百分比表
tabn(css21, v4, a1b1)
# 或者显式指定
tabn(css21, v4, a1b1, "row")
tabn(css21, v4, a1b1, "col")
```

## 社会状况与态度相关变量结果

### 家庭经济与困难情况  

只有A卷的受访者回答了欠款情况，大概5035个受访者。
```{r}
# 欠款情况

tab1(css21, c6a)
tab1(css21, c6b)
mrtab(css21,  c6c1:c6c6,select_value="是")
mrtab(css21,  c6d1:c6d10,select_value="是")
tab1(css21, c6e)

# 过去12个月遇到的生活困难
mrtab(css21,  d1a1:d1a14,select_value="是")

# 过去一年遇到下列事情
mrtab(css21,  d2a1:d2a7,select_value="是")

# 是否找人帮忙
tab1(css21, d2b1)
tab1(css21, d2b2)
tab1(css21, d2b3)
tab1(css21, d2b4)
tab1(css21, d2b5)
tab1(css21, d2b6)

#是否办成了
tab1(css21, d2c1)
tab1(css21, d2c2)
tab1(css21, d2c3)
tab1(css21, d2c4)
tab1(css21, d2c5)
tab1(css21, d2c6)

# 家庭生活满意度  B卷
tab_1(css21,  d3a1:d3a6)
#社会关系自我评价 A卷
tab_1(css21,  d3b1:d3b7)

# 近半年是否遇到下列情况 A卷
tab_1(css21,  d3c1:d3c4)

# 社会经济地位
tab1(css21, d4a)

# 5年前社会经济地位
tab1(css21, d4b)

# 未来5年社会经济地位
tab1(css21, d4c)

# 5年变化
tab1(css21, d4d)

# 5年后变化
tab1(css21, d4e)

# 与周边人相比的生活水平
tab_1(css21,  d4f1:d4f7)

```

### 其他生活状况
```{r}
# 上网及频次
tab1(css21, d5a)
tabn(css21,a1c1,d5a,"row")
tabn(css21,v4,d5a,"row")
tab_1(css21,  d5b1:d5b8)

# 近2年加入网上社群情况
tab_1(css21,  d5c1:d5c12)

# 污染情况  A卷
tab_1(css21,  d6a1:d6a4)
tab1(css21, d6b)

#人的价值体现在  B卷
tab1(css21, d7a)

#遇到困难时首先求助于谁 B卷
tab1(css21, d7b)

#疫情以来的变化  A卷
tab_1(css21,  d8a_1:d8a_6)

#近一年是否有下列行为 多选
mrtab(css21,  d9a_1:d9a_8,select_value="是")

# 消费观念
tab_1(css21,  d9b_1:d9b_6)

```

### 社会保障
```{r}
# 养老保险
tab1(css21, e1a)
mrtab(css21,  e1b_1:e1b_4,select_value="是")
#医疗保险
tab1(css21, e2a)
mrtab(css21,  e2b_1:e2b_5,select_value="是")
#就医
tab1(css21, e3b)
#就医困难
tab_1(css21,  e3c_1:e3c_5)
# 社会保险
tab_1(css21,  e4_1:e4_4)
# 社会保障满意度
tab_1(css21,  e5_1:e5_6)
tab_1(css21,  e6a:e6b)

```

### 社会信任与社会公平
```{r}
# 机构信任
tab_1(css21,  f1a_1:f1a_10)

#一般信任
tab1(css21, f1b)

#社会不公平
tab_1(css21,  f2a_1:f2a_8)

#社会包容
tab_1(css21,  f2b_1:f2b_6)
tab1(css21, f2c)

# 社会冲突
tab_1(css21,  f2d_1:f2d_6)

#社会公平
tab_1(css21,  f3a_1:f3a_8)
tab1(css21, f3b)

```
### 社会价值感与社会评价
```{r}
# 爱国
tab_1(css21,  g1a_1:g1a_6)
tab_1(css21,  g1b_1:g1b_6)
# 道德水平与守法水平
tab1(css21, g2a)
tab1(css21, g2b)

# 政府工作好坏
tab_1(css21,  g3a_1:g3a_15)
# 最大的三个社会问题
mrtab(css21, g4_1:g4_15,select_value="是")

# 多维度安全
tab_1(css21,  g5a_1:g5a_9)

#总体评价与国际地位
tab_1(css21,  g6:g7a_6)

```

### 社会参与和政治参与
```{r}
#社会团体
mrtab(css21,  h1a_1:h1a_9,select_value="是")
#公共表达
mrtab(css21,  h2a_1:h2a_12,select_value="是")


#村居委会选举
tab1(css21, h3a)
tab1(css21, h3b)
#您了解这次社区居委会/村委会选举的候选人的下列哪些情况?(可多选)
mrtab(css21,  h3c_1:h3c_5,select_value="是")
tab1(css21, h3d)
tab1(css21, h4)

#您了解这次区县人大代表选举的候选人的下列哪些情况?(可多选)
tab1(css21, h5a)
mrtab(css21,  h5b_1:h5b_5,select_value="是")
tab1(css21, h5c)
#您是否同意以下说法 基层自治
tab_1(css21,h6a_1:h6a_9)

```

### 志愿服务
```{r}

#一般来说，我们所说的志愿服务是指自愿、无偿地为家庭成员之外的人或事物提供的劳动服务，不是捐钱、捐物、献血等捐赠行为。您本人在近一年以来参加过以下哪些 志愿服务?(可多选)
mrtab(css21,  i1a_1:i1a_13,i1a_14,select_value="是")

#您近一年以来参加的志愿服务主要是由谁组织的?(可多选)
mrtab(css21,   i2a_1:i2a_7,select_value="是")

tab1(css21, i3)
tab1(css21, i4)
tab1(css21, i5)
tab1(css21, i6)

#不足
mrtab(css21,  i7a_1:i7a_8,select_value="是")
# 近三个月志愿服务次数和时长
tab1(css21, i8a)
tab1(css21, i8b)

#志愿服务需求
mrtab(css21,  i9a_1:i9a_14,select_value="是")


```



